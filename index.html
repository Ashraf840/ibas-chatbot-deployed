<html>
  <head>
  </head>
    <body>
      <script>
        // const session_ID = require('./index.js')
        
        !(function () {
          let e = document.createElement("script"),
            t = document.head || document.getElementsByTagName("head")[0];
          (e.src =
            "./index.js"),
            // Replace 1.x.x with the version that you want
            (e.async = !0),
            (e.onload = () => {
              setTimeout(function myStopFunction() {
                console.log("session id from", socket_ID);
              }, 1000);
              window.WebChat.default(
                {
                  title: "Agrani",
                  initPayload: JSON.stringify({intent: '/greet_en'}),
                  customData: { language: "en", agentName: this.name },
                  socketUrl: "http://localhost:5005",
                  inputTextFieldHint: "Type a message",
                  showMessageDate: true,
                  displayUnreadCount: true
                },
                null
              );
            }),
            t.insertBefore(e, t.firstChild);
        })();
      </script>
    </body>
</html>



  <!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rasa Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/@rasahq/rasa-webchat@3.1.0/lib/index.min.js"></script>
</head>
<body>
    <div id="webchat"></div>
    
    <script>
    const response = await fetch('http://192.168.0.23:8000/home/api/user-chatbot/socket/9e766b57696f4f61af7f83a1d6550c27/');
    const data = await response.json();

    const nid = prompt("Please enter your NID:");

    if (nid === data.user_NID_no) {
      const webchat = document.querySelector('#webchat');

      WebChat.default.init({
          selector: "#webchat",
          initPayload: '/get_started',
          customData: {"language": "en"}, // arbitrary custom data. Stay minimal as this will be added to the socket
          socketUrl: "https://your-rasa-endpoint.com",
          socketPath: "/socket.io/",
          title: "Your bot's name",
          subtitle: "Subtitle",
          inputTextFieldHint: "Type a message...",
          hideWhenNotConnected: true,
          params: {
              images: {
                  dims: {
                      width: 300,
                      height: 200,
                  }
              },
              storage: "session"
          }
      })
    } else {
      alert("Invalid NID. Please try again.");
    }
    </script>
</body>
</html> -->

<!-- 

<html>
  <head>
  </head>
    <body>
      <script>
        !(function () {
          let e = document.createElement("script"),
            t = document.head || document.getElementsByTagName("head")[0];
          (e.src =
            "./index.js"),
            (e.async = !0),
            (e.onload = () => {
              async function validateNID() {
                const response = await fetch('http://192.168.0.23:8000/home/api/user-chatbot/socket/9e766b57696f4f61af7f83a1d6550c27/');
                const data = await response.json();
                const userNID = data.user_nid_no;
      
                // Validate the NID
                let isNIDValid = false;
                const validateNID = (msg) => {
                  if (msg === userNID) {
                    isNIDValid = true;
                    window.removeEventListener('message', handleNIDValidation);
                  }
                };
      
                const handleNIDValidation = (event) => {
                  if (event.data && event.data.type === 'validate_nid') {
                    const msg = event.data.msg;
                    validateNID(msg);
                  }
                };
      
                window.addEventListener('message', handleNIDValidation);
      
                const openChatbot = () => {
                  if (isNIDValid) {
                    setTimeout(function myStopFunction() {
                      console.log("session id from", socket_ID);
                    }, 1000);
                    window.WebChat.default(
                      {
                        title: "Agrani",
                        initPayload: JSON.stringify({ intent: '/greet_en' }),
                        customData: { language: "en", agentName: this.name },
                        socketUrl: "http://localhost:5005",
                        inputTextFieldHint: "Type a message",
                        showMessageDate: true,
                        displayUnreadCount: true
                      },
                      null
                    );
                  }
                };
      
                // Render the chatbot window with a form to input the NID
                const chatbotContainer = document.createElement('div');
                chatbotContainer.setAttribute('id', 'chatbot-container');
                const formHTML = `
                  <form onsubmit="event.preventDefault(); parent.postMessage({type: 'validate_nid', msg: this.nid.value}, '*');">
                    <label for="nid">Please enter your NID:</label>
                    <input type="text" id="nid" name="nid">
                    <input type="submit" value="Connect">
                  </form>
                `;
                chatbotContainer.innerHTML = formHTML;
                document.body.appendChild(chatbotContainer);
      
                // Focus the NID input field
                const nidInput = document.getElementById('nid');
                nidInput.focus();
      
                // Connect to the chatbot when the form is submitted
                const form = document.querySelector('form');
                form.addEventListener('submit', openChatbot);
              }
      
              validateNID();
            }),
            t.insertBefore(e, t.firstChild);
        })();
      </script>
      
</body>
</html> -->
